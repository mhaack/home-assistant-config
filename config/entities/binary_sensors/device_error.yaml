---
# Aggregated sensor holding the share error state
#
# https://www.home-assistant.io/components/sensor.template/
#

platform: template
sensors:
  sensor_error:
    friendly_name: "Sensor Error Triggered"
    entity_id:
      - binary_sensor.fenster_arbeitszimmer_state
      - binary_sensor.fenster_essbereiclsh_state
      - binary_sensor.fenster_gaste_wc_state
      - binary_sensor.fenster_hwr_state
      - binary_sensor.fenster_kuche_state
      - binary_sensor.fenster_wohnzimmer_sofa_state
      - binary_sensor.fenster_wohnzimmer_state
      - binary_sensor.haustur_state
      - binary_sensor.schiebetur_wohnzimmer_state
      - binary_sensor.tur_carport_state
      - binary_sensor.bewegungsmelder_flur_eg_1_motion
      - binary_sensor.bewegungsmelder_flur_og_motion
      - binary_sensor.bewegungsmelder_wohnzimmer_motion
      - sensor.pool_sensor_1_temperature
      - sensor.sirene_carport_armstate
      - sensor.sirene_haus_armstate
    value_template: >
      {% macro sensor_error() %}
      {%- set domains = ['sensor', 'binary_sensor'] -%}
      {%- for domain in domains -%}
        {%- for item in states[domain] if ((item.attributes.error is defined and item.attributes['error'] | lower != "no") or (item.attributes.sabotage is defined and item.attributes['sabotage'] | lower != "no")) -%}
          {{ item.attributes.friendly_name }}
        {%- endfor -%}
      {%- endfor -%}
      {% endmacro %}
      {{ sensor_error() | trim != ""}}
