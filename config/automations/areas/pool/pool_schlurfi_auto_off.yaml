---
# Send notication if pool cleaner is outside late in the evening
#
alias: "[Pool] Switch off pool cleaner if still on"
trigger:
  platform: time
  at: "22:00:00"
condition:
  condition: and
  conditions:
    - condition: state
      entity_id: switch.sonnendeck_steckdosen
      state: "on"
    - condition: state
      entity_id: input_boolean.pool_notification
      state: "on"
    - condition: template
      value_template: >
        {% if states.automation.pool_switch_off_pool_cleaner_if_still_on.last_triggered is not none %}
          {% if as_timestamp(now()) | int -  as_timestamp(states.automation.pool_switch_off_pool_cleaner_if_still_on.attributes.last_triggered) | int > 1800 %}
          true
          {% else %}
          false
          {% endif %}
        {% else %}
        false
        {% endif %}
action:
  - service: switch.turn_off
    data:
      entity_id: switch.sonnendeck_steckdosen
  - service: notify.ios_iphone_von_markus
    data:
      title: "JaMa Villa"
      message: "Achtung! Schlürfi war noch an, nicht vergessen ihn rein zu räumen."
